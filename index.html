<script>
/* Items Data — ONLY YOUR ITEMS */
const items = [
    {
        name: "Sticky Notes",
        price: 50,
        category: "stationery",
        img: "https://softwaretested.com/wp-content/uploads/2019/05/Sticky-Notes.png"
    },
    {
        name: "Cheap Silent Mouse",
        price: 150,
        category: "electronics",
        img: "https://m.media-amazon.com/images/S/aplus-media/vc/7ecce7bc-e939-4ccd-87ec-570d7cc95f9a.jpg"
    }
];

let cart = []; // each entry: { name, price, qty }

/* Add to Cart */
function addToCart(name, price) {
    const qty = parseInt(document.getElementById("qty-" + name).value);

    // check if item exists already
    const existing = cart.find(i => i.name === name);

    if (existing) {
        existing.qty += qty;
    } else {
        cart.push({ name, price, qty });
    }

    document.getElementById("dingSound").play();
    renderCart();
}

/* Render Cart (grouped!) */
function renderCart() {
    const list = document.getElementById("cartList");
    list.innerHTML = "";

    total = 0;

    cart.forEach((item, index) => {
        const subtotal = item.price * item.qty;
        total += subtotal;

        list.innerHTML += `
            <li>
                ${item.name} — NT$${item.price} × ${item.qty}
                <button onclick="removeItem(${index})">❌</button>
            </li>
        `;
    });

    document.getElementById("total").innerText = total;

    document.getElementById("paymentRule").innerText =
        total >= 500 ? "Cash Before Delivery" : "Cash Only";
}

/* Remove item */
function removeItem(i) {
    cart.splice(i, 1);
    renderCart();
}

/* Checkout email (grouped!) */
function checkout() {
    if (cart.length === 0) {
        alert("Cart is empty!");
        return;
    }

    const order = cart
        .map(i => `${i.name} × ${i.qty} — NT$${i.price * i.qty}`)
        .join("%0A");

    const payment = total >= 500 ? "Cash Before Delivery" : "Cash Only";

    window.location.href =
        `mailto:leofoooo132@gmail.com?subject=New Order&body=Order:%0A${order}%0A%0ATotal: NT$${total}%0APayment: ${payment}`;
}

/* Render Items */
function renderItems() {
    const container = document.getElementById("itemsContainer");
    container.innerHTML = "";

    const search = document.getElementById("searchBar").value.toLowerCase();
    const category = document.getElementById("categorySelect").value;

    items
        .filter(item =>
            (category === "all" || item.category === category) &&
            item.name.toLowerCase().includes(search)
        )
        .forEach(item => {
            container.innerHTML += `
                <div class="item">
                    <img src="${item.img}">
                    <h3>${item.name}</h3>
                    <p>Price: NT$${item.price}</p>
                    Quantity: 
                    <input type="number" id="qty-${item.name}" value="1" min="1" style="width:50px;">
                    <br><br>
                    <button onclick="addToCart('${item.name}', ${item.price})">Add to Cart</button>
                </div>
            `;
        });
}

renderItems();
</script>
