import streamlit as st
import random
from PIL import Image, ImageDraw, ImageFont
import io

# --- PAGE CONFIG ---
st.set_page_config(page_title="üõí Common Store", layout="wide")
st.title("üè™ Common Store - Browse Items")

# --- CATEGORIES ---
categories = ["Games"]

# --- ITEMS (ONLY 1 ITEM ADDED) ---
items = {
    "Games": [
        {
            "name": "Flappy Bird",
            "price": 0,
            "image": None  # add image later
        }
    ]
}

# --- SESSION STATE ---
if "cart" not in st.session_state:
    st.session_state.cart = {}

if "popup" not in st.session_state:
    st.session_state.popup = ""

# --- FUNCTIONS ---
def add_to_cart(name, price):
    if name not in st.session_state.cart:
        st.session_state.cart[name] = {"price": price, "qty": 1}
    else:
        st.session_state.cart[name]["qty"] += 1

    st.session_state.popup = f"‚úÖ Added **{name}** to cart!"
    st.experimental_rerun()

def show_popup():
    if st.session_state.popup:
        st.success(st.session_state.popup)
        st.session_state.popup = ""

# --- SIDEBAR CART ---
with st.sidebar:
    st.header("üõí Cart")
    
    if not st.session_state.cart:
        st.write("Your cart is empty.")
    else:
        total = 0
        for item, info in st.session_state.cart.items():
            st.write(f"**{item}** ‚Äî ${info['price']} √ó {info['qty']}")
            total += info["price"] * info["qty"]

        st.write("---")
        st.subheader(f"Total: **${total}**")

        st.write("### üí≥ Payment Method")
        payment = st.selectbox("Choose payment method:", ["Cash", "Credit Card", "Mobile Pay"])

        st.write("### üöö Delivery Option")
        delivery = st.radio("Choose delivery:", ["Pickup", "Home Delivery"])

        st.button("Checkout")

# --- DISPLAY ITEMS ---
show_popup()

for category in categories:
    st.subheader(category)
    col = st.columns(3)

    for i, item in enumerate(items[category]):
        with col[i % 3]:
            st.write(f"### {item['name']}")
            st.write(f"**Price:** ${item['price']}")

            st.button("Add to Cart", key=f"{category}_{i}",
                      on_click=add_to_cart,
                      args=(item["name"], item["price"]))
